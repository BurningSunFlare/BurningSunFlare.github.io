<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon"; type="image/png"; href="/Images/Icon/Main.png">
  <title>JSON Box System with Image Upload and Save/Load</title>
  <style>
    body {
      background: linear-gradient(to left, #0e052e, #1c1c1c);
    -webkit-background-clip: text;
    background-clip: text;
    color: lightskyblue;
    animation: body 10s ease-in-out infinite;
    background-size: 400% 100%;
    margin: 0; /* Remove default margin */
    padding: 0; /* Remove default padding */
}

@keyframes body {
    0%,100% {
        background-position: 0 0;
    }

    50% {
        background-position: 100% 0;
    }
}
@keyframes rainbow_animation {
    0%,100% {
        background-position: 0 0;
    }

    50% {
        background-position: 100% 0;
    }
}
.box { border: 1px solid #34179d; padding: 10px; margin: 10px; background-color: hsl(211, 94%, 6%); box-shadow: 5px 10px 8px hsl(241, 86%, 11%) }
    .hidden { display: none; }
    .collection, .item { border: 1px dashed #2959c9; padding: 5px; margin-top: 5px; box-shadow: 5px 6px 8px #0d1f4885 }
    .inbox
    {
      background-color: #56209e43;
      color: rgb(147, 194, 255);
      border: 2px solid #4a297e;
      border-radius: 8px;
    }

    .inbox:hover
    {
      border-color: #7426b3;
    }

    .inbox:focus
    {
        outline: 2px solid #7426b3;
        font-weight:bold;
        color: rgb(147, 255, 194);
    }

    .button3
    {
      background-color: #56209e43;
      color: rgb(147, 194, 255);
      border: 2px solid #4a297e;
    }

    .button3:hover
    {
      border-color: lightblue;
    }


    .short
    {
      width: 75px;
    }
    .semishort
    {
      width: 90px;
    }
    .semishort:focus
    {
      color:lightblue;
      background-color: #42005c;
    }
    .tick
    {
      accent-color: green;
    }
    .tick:not(:checked)
    {
      -webkit-appearance: none;
      -moz-appearance: none;
      -o-appearance: none;
      appearance:none;
      width: 10px;
      height: 10px;
      background-color: rgb(171, 9, 9);
      border: 0px dotted #931414;
      color: red;
      content: "x";
    }
    
.rainbow_text_animated
{
    background: linear-gradient(to right, #6666ff, #0099ff , #00ff00, #ff3399, #6666ff);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: rainbow_animation 10s ease-in-out infinite;
    background-size: 400% 100%;
}
.rainbow
{
    text-align: center;
    text-decoration: underline;
    font-size: 32px;
    font-family: monospace;
    letter-spacing: 5px;
}
hr
{
  background: linear-gradient(to right, #3b1194, #22095a);
  height: 5px;
  border:0
}

a
{
    text-align: center;
    color:rgb(162, 100, 237);
}
a:hover
{
    text-align: center;
    color:rgb(202, 165, 245);
}
.frame
{
  background-color: #56209e43;
  border: none;
  border-radius: 2px;
  color: rgb(22, 67, 127);
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  transition-duration: 0.4s;
}
.frame:hover {
  background-color: #0e11106d; /* Green */
  color: white;
}
.upload
{
  background-color: #56209e43; /* Green */
  border: none;
  border-radius: 2px;
  color: rgb(147, 194, 255);
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  transition-duration: 0.4s;
}
.upload:hover {
  background-color: #0e11106d; /* Green */
  color: white;
}
.button1
{
  background-color: #04AA6D; /* Green */
  border: none;
  border-radius: 2px;
  color: rgb(22, 67, 127);
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  transition-duration: 0.4s;
}
.button1:hover {
  background-color: #0e1110; /* Green */
  color: white;
}

.button2
{
  background-color: #04AA6D; /* Green */
  border: none;
  width: 120px;
  height: 60px;
  margin-top: 25px;
  border-radius: 2px;
  color: rgb(22, 67, 127);
  padding: 20px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  transition-duration: 0.4s;
}
.button2:hover {
  background-color: #2f055f; /* Green */
  color: rgb(0, 146, 250);
}

.tooltip .tooltiptext {
  width: 120px;
  top: 100%;
  left: 50%;
  margin-left: -60px; /* Use half of the width (120/2 = 60), to center the tooltip */
}

h2 {text-align: center;}
  </style>
</head>
<body>
<hr>
<h2 class="rainbow rainbow_text_animated">Ultrasound DEVELOPER</h2>
<form id="password-form">
    <label for="password">Enter Password:</label>
    <input type="password" id="password" required class="inbox">
    <button type="submit" class="button3">Submit</button>
</form>
<p id="error-message" class="hidden">Incorrect password, please try again.</p>

<script>
    document.getElementById("password-form").addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent form from refreshing the page
        const passwordInput = document.getElementById("password").value;

        if (passwordInput === "Pineapple") {
            //alert("Password correct! Welcome.");
            const errorMessage = document.getElementById("error-message");
            errorMessage.classList.remove("hidden");
            errorMessage.classList.add("hidden");
            uploadJSON()
        } else {
            const errorMessage = document.getElementById("error-message");
            errorMessage.classList.remove("hidden");
            document.getElementById("password").value = ""; // Clear input
            document.getElementById("password").focus(); // Refocus on input
        }
    });
</script>
<hr>
<div>
  <!-- <button onclick="toggleMode()" class="button1">Toggle Edit/Preview Mode</button> -->
  <!-- button onclick="createBox()" class="button1">Create Box</button -->
  <!-- button onclick="uploadJSON()" class="button1" id="imhidden">Upload JSON</button -->
  <input type="file" id="fileInput" class="hidden" accept=".json" onchange="loadJSON(this.files)">
  <button onclick="downloadJSON()" class="button1">Save JSON</button>
</div>

<div id="mainBox" class="box">
  <h3 id="mainTitle" contenteditable="true">Default Title</h3>
  <img id="mainImage" src="/Images/Icon/Kittyd.gif" alt="Main Image" width="256" height="256" class="frame">
  <br>
  <input type="file" onchange="updateImage(this, 'mainImage')" class="upload">
  <p id="mainCredits" contenteditable="true">This is where the credits go</p>
  <button class="button3" onclick="addCollection()">Add Collection</button>
  <div id="collectionsContainer"></div>
</div>

<div>
  <hr>
  <button onclick="Ultrabox()" class = "button3">Ultrabox</button>
  <button onclick="Abyssbox()" class = "button3">Abyssbox</button>
  <br>
  <input class="inbox" type="text" id="exportUrlInput" placeholder="Main Url" class="tooltip">
  <span class="tooltiptext">Grab your base url. Abyssbox or Ultrabox for example, then click Load Samples</span>
  <br>
  <button onclick="exportURLs()" class = "button3">Load Samples</button>
</div>

<script>
let isEditMode = true;

function toggleMode() {
  isEditMode = !isEditMode;
  document.getElementById("mainBox").contentEditable = isEditMode ? "true" : "false";
}

function createBox() {
  document.getElementById("mainBox").classList.remove("hidden");
}

function updateImage(input, imageId) {
  const file = input.files[0];
  const reader = new FileReader();
  reader.onload = function(e) {
    document.getElementById(imageId).src = e.target.result;
  };
  if (file) reader.readAsDataURL(file);
}

function addCollection(data = null) {
  const container = document.createElement("div");
  container.classList.add("collection");

  const collectionImageId = `collectionImage${document.getElementsByClassName('collection').length}`;
  container.innerHTML = `
    <h4 contenteditable="true">${data ? data.title : 'Collection Title'}</h4>
    <p contenteditable="true">${data ? data.description : 'Collection Description'}</p>
    <img id="${collectionImageId}" src="${data ? data.image : '/Images/Icon/missing.gif'}" alt="Collection Image" width="128" height="128" class="frame">
    <br>
    <input type="file" onchange="updateImage(this, '${collectionImageId}')" class="upload"">
    <p contenteditable="true">${data ? data.credits : 'Collection Credits'}</p>
    <button class="button3" onclick="addItem(this)">Add Item</button>
    <div class="items-container hidden"></div> <!-- Items container is hidden initially -->
    <span class="dropdown-arrow" onclick="toggleItemsVisibility(this)">&#9660;</span> <!-- Dropdown arrow -->
  `;

  const itemsContainer = container.querySelector(".items-container");
  if (data && data.items) {
    data.items.forEach(item => addItem(container.querySelector('button'), item));
  }

  document.getElementById("collectionsContainer").appendChild(container);
}

function addItem(button, data = null) {
  const itemContainer = document.createElement("div");
  itemContainer.classList.add("item");

  itemContainer.innerHTML = `
    <label>Sound Name: <input type="text" value="${data ? data.soundName : ''}"class="inbox"></label>
    <label>Loop Start: <input type="number" value="${data ? data.loopStart : 0}"class="inbox short"></label>
    <label>Loop End: <input type="number" value="${data ? data.loopEnd : 0}"class="inbox short"></label>
    <label>Offset: <input type="number" value="${data ? data.offset : 0}"class="inbox short"></label>
    <label>Loop Type: 
      <select class="inbox semishort">
        <option value="d0" ${data && data.loopType === 'd0' ? 'selected' : ''}>Loop</option>
        <option value="d1" ${data && data.loopType === 'd1' ? 'selected' : ''}>Ping Pong</option>
        <option value="d2" ${data && data.loopType === 'd2' ? 'selected' : ''}>Play Once</option>
        <option value="d3" ${data && data.loopType === 'd3' ? 'selected' : ''}>Loop Play Once</option>
      </select>
    </label>
    <label>Backwards: <input type="checkbox" ${data && data.backwards ? 'checked' : ''}class="tick"></label><br>
    <label>Link: <input type="text" placeholder="Enter item link" value="${data ? data.link : ''}"class="inbox"></label>
    <label> <input type="checkbox" ${data && data.export ? 'checked' : ''}class="hidden"></label>
  `;
  //<label>Export: <input type="checkbox" ${data && data.export ? 'checked' : ''}></label>

  button.nextElementSibling.appendChild(itemContainer);
}

function uploadJSON() {
    document.getElementById("fileInput").click();
}

function loadJSON(files) {
  const file = files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const data = JSON.parse(e.target.result);
    populateData(data);
  };
  reader.readAsText(file);
}

function populateData(jsonData) {
  if (!jsonData) {
    alert("Invalid JSON format or missing data.");
    return;
  }

  const mainData = jsonData;

  // Populate the main box fields
  document.getElementById("mainTitle").textContent = mainData.title || "Default Title";
  document.getElementById("mainImage").src = mainData.image || "/Images/Icon/missing.gif";
  document.getElementById("mainCredits").textContent = mainData.credits || "This is where the credits go";

  // Clear previous collections if any
  const collectionsContainer = document.getElementById("collectionsContainer");
  collectionsContainer.innerHTML = "";

  // Populate collections and their items
  if (mainData.collections && mainData.collections.length > 0) {
    mainData.collections.forEach(collectionData => addCollection(collectionData));
  }
}



function downloadJSON() {
  const mainBox = {
    title: document.getElementById("mainTitle") ? document.getElementById("mainTitle").textContent : "Default Title",
    image: document.getElementById("mainImage") ? document.getElementById("mainImage").src : "/Images/Icon/missing.gif",
    credits: document.getElementById("mainCredits") ? document.getElementById("mainCredits").textContent : "This is where the credits go",
    collections: []
  };

  // Loop through all collections
  document.querySelectorAll('.collection').forEach(collection => {
    const collectionData = {
      title: collection.querySelector('h4') ? collection.querySelector('h4').textContent : "Collection Title",
      description: collection.querySelector('p:nth-of-type(1)') ? collection.querySelector('p:nth-of-type(1)').textContent : "Collection Description",
      image: collection.querySelector('img') ? collection.querySelector('img').src : "/Images/Icon/missing.gif",
      credits: collection.querySelector('p:nth-of-type(2)') ? collection.querySelector('p:nth-of-type(2)').textContent : "Collection Credits",
      items: []  // Initialize an empty array for items
    };

    // Loop through all items in the collection
    collection.querySelectorAll('.item').forEach(item => {
      const inputs = item.querySelectorAll('input');  // Get all inputs in the item
      const soundNameInput = inputs[0];  // First input for sound name
      const loopStartInput = inputs[1];  // Second input for loop start
      const loopEndInput = inputs[2];  // Third input for loop end
      const offsetInput = inputs[3];  // Fourth input for offset
      const loopTypeSelect = item.querySelector('select');  // Select for loop type
      const backwardsCheckbox = item.querySelector('input[type="checkbox"]');  // Checkbox for backwards
      const linkInput = inputs[5];  // Fifth input for link (assuming it's in the right order)
      const exportCheckbox = item.querySelector('input[type="checkbox"]:last-of-type');  // Export checkbox

      // Debugging: Log the inputs to see if they exist
      console.log("Sound Name:", soundNameInput ? soundNameInput.value : "Not found");
      console.log("Loop Start:", loopStartInput ? loopStartInput.value : "Not found");
      console.log("Loop End:", loopEndInput ? loopEndInput.value : "Not found");
      console.log("Offset:", offsetInput ? offsetInput.value : "Not found");
      console.log("Link:", linkInput ? linkInput.value : "Not found");
      console.log("Export:", exportCheckbox ? exportCheckbox.checked : "Not found");

      // Ensure loopStart, loopEnd, and offset have default values when they're missing
      const itemData = {
        soundName: soundNameInput ? soundNameInput.value : "",
        loopStart: loopStartInput ? parseInt(loopStartInput.value) || 0 : 0, // Default to 0 if empty
        loopEnd: loopEndInput ? parseInt(loopEndInput.value) || 0 : 0, // Default to 0 if empty
        offset: offsetInput ? parseInt(offsetInput.value) || 0 : 0, // Default to 0 if empty
        loopType: loopTypeSelect ? loopTypeSelect.value : 'd0', // Default loopType if not selected
        backwards: backwardsCheckbox ? backwardsCheckbox.checked : false,
        link: linkInput ? linkInput.value : '', // Ensure we get the correct link from the second input
        export: exportCheckbox ? exportCheckbox.checked : false // Ensure export field is properly captured
      };

      // Debugging: Log item data to check
      console.log("Item Data:", itemData);

      // Add item data to the collection's items array
      collectionData.items.push(itemData);
    });

    // Add collection data to the main collections array
    mainBox.collections.push(collectionData);
  });

  // If no collections exist, prevent export and show a message
  if (mainBox.collections.length === 0) {
    alert("No collections to export.");
    return;
  }

  // Convert data to JSON and trigger download
  const blob = new Blob([JSON.stringify(mainBox, null, 2)], { type: "application/json" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "data.json";
  link.click();
}

function Ultrabox()
{
  document.getElementById("exportUrlInput").value = "https://ultraabox.github.io/testing/#u6N08Untitled00000n310s0k02l00e03t1Ua7g0fj07r1O_U00000000i0o321T1v0pu39f0000q0wB162110O01d080A0F0B0Q7er4Pa610R0000E3c0ba61a628T1v0pu63f0000q0wB171110O01d080A1F1B4Qa4i4Pea3bR0000E2c0b962aT6v0pu75f010n900q08420O0d030WO00h0E1c02cT2v0pu15f180q0040O0d030w0h0E0c0b4h400000000h4g000000014h000000004h400000000p16000000"
}

function Abyssbox()
{
  document.getElementById("exportUrlInput").value = "https://choptop84.github.io/abyssbox-app/#a2N08UntitledY04nonen311s0k02l00e03t1Ua7g0fj07r3O_U0000000000i0o321T0v0pu86f0000q00000B1900Oa1d350w60h3y0000000000000g000000E1c0bcT5v0pulif031742e42k400q0000AD010q50002Q0Oa2ud880HU2h80000020p00h3E1c0c09T5v0pua5f060lc2dd2j02e02fd17800q00008540Oaad260HK_Sziiirrqih99h0E0c0T2v0pu15f180q0000040Oad030w0h0E0c0Tav0pu43f0000q0000w510Oa1d030E0c0b4h400000000h4g000000014h000000004h400000000h4g00000000p1900000f_M0"
}

function exportURLs() {
  const baseUrl = document.getElementById("exportUrlInput") ? document.getElementById("exportUrlInput").value : "";
  let exportStr = "";

  document.querySelectorAll('.collection .item').forEach(item => {
    const inputs = item.querySelectorAll('input');
    const soundNameInput = inputs[0];
    const loopStartInput = inputs[1];
    const loopEndInput = inputs[2];
    const offsetInput = inputs[3];
    const loopTypeSelect = item.querySelector('select');
    const backwardsCheckbox = item.querySelector('input[type="checkbox"]');
    const linkInput = inputs[5];
    const exportCheckbox = item.querySelector('input[type="checkbox"]:last-of-type');

    if (exportCheckbox && exportCheckbox.checked) {
      const soundName = encodeURIComponent(soundNameInput ? soundNameInput.value : '');
      const loopStart = loopStartInput ? parseInt(loopStartInput.value) || 0 : 0;
      const loopEnd = loopEndInput ? parseInt(loopEndInput.value) || 0 : 0;
      const offset = offsetInput ? parseInt(offsetInput.value) || 0 : 0;
      const loopType = loopTypeSelect ? loopTypeSelect.value : 'd0';
      const backwards = backwardsCheckbox && backwardsCheckbox.checked ? 1 : 0;
      const link = linkInput ? linkInput.value : '';

      const fullUrl = `|!a${loopStart},b${loopEnd},c${offset},${loopType}${backwards}!${link}`;
      exportStr += fullUrl;
    }
  });

  console.log(baseUrl + exportStr); // Output the URLs in console for testing
  window.location.href = baseUrl + exportStr;
  //alert("Exported URLs:\n" + exportStr); // Display exported URLs in an alert for now
}



function toggleItemsVisibility(arrow) {
  const itemsContainer = arrow.parentElement.querySelector(".items-container");
  if (itemsContainer.classList.contains("hidden")) {
    itemsContainer.classList.remove("hidden");
    arrow.innerHTML = "&#9650;"; // Change arrow to "up" when showing items
  } else {
    itemsContainer.classList.add("hidden");
    arrow.innerHTML = "&#9660;"; // Change arrow to "down" when hiding items
  }
}

</script>
<footer>
  <hr>
  <h2>DISCLAIMER:</h2>
  <p>I do NOT have a server that saves any DATA, nor do I have anything that goes through networking.
  Github has STATIC websites, and I do not have money for an actual server lol.
  I made this entirely with the purpose of freedom to do what you want, and I hold no consequences to what people do with this.<p>
  <h2>TIPS:</h2>
  <ol>
  <li>Do not use the enter key to try and create a line break
    <br>
    LIKE
    <br>
    THIS
    <br>
    Instead, you should type LIKE THIS as LIKE&lt;br&gt;THIS. When you use br, you are telling the webpage to line break aka pressing enter on your keyboard. <b>casing is important!</b>
    <li>&lt;b&gt; <b>PUT TEXT LIKE THIS TO MAKE IT BOLD!</b> &lt;/b&gt;</li>
    <li>&lt;i&gt; <i>PUT TEXT LIKE THIS TO MAKE IT ITALICS!</i> &lt;/i&gt;</li>
    <li>&lt;u&gt; <u>PUT TEXT LIKE THIS TO MAKE IT UNDERLINE!</u> &lt;/u&gt;</li>
    <p>Note: These are actually exploits I found out lol. I won't patch them out, why? Cos you can make cool ass themes!
      <br>
      HUGE NOTE: THIS ALSO PROBABLY MEANS ANYONE CAN RUN JAVASCRIPT IN THESE JSON FILES. OPEN UP YOUR JSON FILES AND SEARCH "script" TO SEE IF PEOPLE WOULD INJECT SOMETHING! More than likely, no one would, and there's probably nothing people can do to seriously screw you up. I would find it funny though if someone just embedded PACMAN into this LMAO.
    </p>
   </li>
  </ol>
  
  </footer>
</body>
</html>
